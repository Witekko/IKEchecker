{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
    <div>
        <h2 class="fw-bold text-white mb-0">Portfolio Holdings</h2>
        <p class="text-muted mb-0">Detailed breakdown by market</p>
    </div>
    {% include 'includes/time_filters.html' %}
</div>

{% include 'includes/summary_tiles.html' %}

{# --- SEKCJA 1.1: GPW STOCKS --- #}
{% include 'includes/asset_table.html' with assets=pln_stocks title="GPW Stocks" icon="ğŸ‡µğŸ‡±" table_id="table-pln-stocks" stats=pln_stocks_stats %}

{# --- SEKCJA 1.2: GPW ETFs --- #}
{% include 'includes/asset_table.html' with assets=pln_etfs title="GPW ETFs" icon="ğŸ‡µğŸ‡±" table_id="table-pln-etfs" stats=pln_etfs_stats %}

{# --- SEKCJA 2.1: GLOBAL STOCKS --- #}
{% include 'includes/asset_table.html' with assets=foreign_stocks title="Global Stocks" icon="ğŸŒ" table_id="table-foreign-stocks" stats=foreign_stocks_stats %}

{# --- SEKCJA 2.2: GLOBAL ETFs --- #}
{% include 'includes/asset_table.html' with assets=foreign_etfs title="Global ETFs" icon="ğŸŒ" table_id="table-foreign-etfs" stats=foreign_etfs_stats %}

{# --- SEKCJA 3: ZAMKNIÄ˜TE (CLOSED) --- #}
{% include 'includes/asset_table.html' with assets=closed_items title="Closed Positions" icon="ğŸ”’" table_id="table-closed" is_closed=True %}

<script src="{% static 'js/tables.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Handle clickable rows
        const rows = document.querySelectorAll('.clickable-row');
        rows.forEach(row => {
            row.addEventListener('click', function() {
                window.location.href = this.dataset.href;
            });
        });

        // Handle progress bars width
        const progressBars = document.querySelectorAll('.progress-bar[data-width]');
        progressBars.forEach(bar => {
            bar.style.width = bar.dataset.width + '%';
        });

        // Handle sortable headers
        const sortableHeaders = document.querySelectorAll('th.sortable');
        sortableHeaders.forEach(th => {
            th.addEventListener('click', function() {
                const colIndex = this.getAttribute('data-sort-col');
                const tableId = this.getAttribute('data-table-id');
                if (colIndex !== null && tableId) {
                    sortTable(parseInt(colIndex), tableId);
                }
            });
        });
    });
</script>

{% endblock %}