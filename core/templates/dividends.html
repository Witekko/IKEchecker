{% extends 'base.html' %}
{% load static %}

{% block content %}

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-1 text-white">Dividend Center</h2>
            <p class="text-muted mb-0">Your passive income source. Values in PLN.</p>
        </div>
        <div>
            <span class="badge bg-dark border border-success text-success px-3 py-2 rounded-pill"
                  style="color: var(--accent-green) !important; border-color: var(--accent-green) !important;">
                <i class="fas fa-coins me-2"></i>Passive Income
            </span>
        </div>
    </div>

    <div class="row g-3 mb-5">
        <div class="col-md-3">
            <div class="card h-100 shadow-sm border-secondary border-opacity-25 bg-dark">
                <div class="card-body py-3">
                    <div class="text-muted small fw-bold text-uppercase mb-1">Net Dividends</div>
                    <h3 class="mb-0 fw-bold text-success">{{ total_net }} <small class="fs-6 text-muted">PLN</small></h3>
                    <small class="text-muted">After tax</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100 shadow-sm border-secondary border-opacity-25 bg-dark">
                <div class="card-body py-3">
                    <div class="text-muted small fw-bold text-uppercase mb-1">Gross Total</div>
                    <h3 class="mb-0 fw-bold text-white">{{ total_gross }}</h3>
                    <small class="text-muted">Before tax</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100 shadow-sm border-secondary border-opacity-25 bg-dark">
                <div class="card-body py-3">
                    <div class="text-muted small fw-bold text-uppercase mb-1">Tax Paid</div>
                    <h3 class="mb-0 fw-bold text-danger">{{ total_tax }}</h3>
                    <small class="text-muted">Withholding tax</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100 shadow-sm border-secondary border-opacity-25 bg-dark">
                <div class="card-body py-3">
                    <div class="text-muted small fw-bold text-uppercase mb-1">Top Payer</div>
                    {% if top_payer %}
                        <h3 class="mb-0 fw-bold text-warning">{{ top_payer.symbol }}</h3>
                        <small class="text-muted">{{ top_payer.amount }} PLN</small>
                    {% else %}
                        <h3 class="mb-0 fw-bold text-muted">-</h3>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-lg-6">
            <div class="card h-100 border-secondary border-opacity-25 shadow-sm">
                <div class="card-header bg-transparent border-0 pt-3">
                    <h6 class="text-uppercase text-muted fw-bold mb-0 ls-1">Annual Growth</h6>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="yearlyChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card h-100 border-secondary border-opacity-25 shadow-sm">
                <div class="card-header bg-transparent border-0 pt-3 d-flex justify-content-between">
                    <h6 class="text-uppercase text-muted fw-bold mb-0 ls-1">Seasonality</h6>
                    <select id="yearSelector" class="form-select form-select-sm bg-dark text-white border-secondary" style="width: 100px;">
                        {% for y in years_labels %}
                            <option value="{{ y }}" {% if forloop.last %}selected{% endif %}>{{ y }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="monthlyChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card border-secondary border-opacity-25 mb-5">
        <div class="card-header bg-transparent border-0 pt-3">
            <h5 class="fw-bold text-white mb-0">Payer Breakdown</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0" id="divTable">
                    <thead class="bg-dark text-uppercase small">
                        <tr>
                            <th class="ps-4 py-3 sortable" onclick="sortTable(0, 'divTable')">Asset</th>
                            <th class="text-end sortable" onclick="sortTable(1, 'divTable')">Total Received (PLN)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in payers_list %}
                        <tr>
                            <td class="ps-4 fw-bold text-white">{{ p.symbol }}</td>
                            <td class="text-end pe-4 text-success fw-bold">{{ p.amount }}</td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="2" class="text-center py-4 text-muted">No dividends yet.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    {# --- DATA ISLANDS --- #}
    {{ years_labels|json_script:"d-years-lbl" }}
    {{ years_data|json_script:"d-years-val" }}
    {{ monthly_data|json_script:"d-months-val" }}
    {{ all_monthly_data|json_script:"d-all-months" }}

    <script src="{% static 'js/charts_dividends.js' %}"></script>
    <script src="{% static 'js/tables.js' %}"></script>

{% endblock %}