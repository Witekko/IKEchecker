{% extends 'base.html' %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold text-white mb-0">Tax Center</h2>
        <p class="text-muted mb-0">
            {% if is_ike %} IKE/IKZE Optimization {% else %} Capital Gains Tax Simulator (PIT-38) {% endif %}
        </p>
    </div>
    {% if is_ike %}
    <div><span class="badge bg-success fs-6">Tax-Free Wrapper Active</span></div>
    {% endif %}
</div>

{% if error %}
    <div class="alert alert-warning">{{ error }}</div>
{% else %}

    {% if is_ike %}
        {# --- SEKACJA IKE (Deferred Tax) --- #}
        <div class="row g-4 mb-5">
            <div class="col-md-6">
                <div class="card border-success border-opacity-25 h-100" style="background: rgba(25, 135, 84, 0.1);">
                    <div class="card-body text-center p-4">
                        <div class="text-success text-uppercase fw-bold mb-2 ls-1">Estimated Tax Shield</div>
                        <h1 class="display-4 fw-bold text-white mb-0">{{ deferred_tax }} <small class="fs-6">PLN</small></h1>
                        <p class="text-muted small mt-2">Money saved by using IKE wrapper.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card border-secondary border-opacity-25 h-100">
                    <div class="card-body p-4">
                        <h5 class="fw-bold text-white mb-3">Early Exit Simulator</h5>
                        <p class="text-muted small">If you withdraw today, you pay 19% tax on gains.</p>
                        <hr class="border-secondary opacity-25">
                        <div class="d-flex justify-content-between mb-2">
                            <span class="text-muted">Total Profit:</span>
                            <span class="text-white fw-bold">{{ total_profit }} PLN</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span class="text-danger">Exit Tax (19%):</span>
                            <span class="text-danger fw-bold">-{{ exit_tax }} PLN</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% else %}
        {# --- SEKCJA STANDARD (PIT-38 Table) --- #}
        <div class="card border-secondary border-opacity-25">
            <div class="card-header bg-transparent border-0 pt-3">
                <h5 class="fw-bold text-white mb-0">Taxable Events (FIFO)</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead>
                            <tr>
                                <th class="ps-4">Date</th>
                                <th>Asset</th>
                                <th class="text-end">Revenue</th>
                                <th class="text-end">Cost</th>
                                <th class="text-end">P/L</th>
                                <th class="text-end pe-4">Tax (19%)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in tax_rows %}
                            <tr>
                                <td class="ps-4 text-white small">{{ row.date }}</td>
                                <td class="fw-bold text-white">{{ row.symbol }}</td>
                                <td class="text-end">{{ row.revenue }}</td>
                                <td class="text-end">{{ row.cost }}</td>
                                <td class="text-end fw-bold {% if row.profit >= 0 %}text-success{% else %}text-danger{% endif %}">{{ row.profit }}</td>
                                <td class="text-end pe-4 text-danger">{{ row.tax }}</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="6" class="text-center py-4 text-muted">No taxable events.</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% endif %}

{% endif %}
{% endblock %}