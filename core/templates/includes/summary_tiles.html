{% load static %}

{# --- ROW 1: MAIN STATS (Value, Profit, Return, TWR, Unrealized) --- #}
<div class="row g-3 mb-4">

    <div class="col-12 col-xl-3">
        <div class="card h-100 border-secondary border-opacity-25 shadow-sm bg-dark">
            <div class="card-body d-flex flex-column justify-content-center py-3 px-4">
                <div class="text-muted text-uppercase small fw-bold mb-1">Total Value</div>
                <h3 class="mb-0 fw-bold text-white text-truncate">
                    {{ tile_value_str }} <span class="fs-6 text-muted fw-normal">PLN</span>
                </h3>
            </div>
        </div>
    </div>

    <div class="col-6 col-md-6 col-xl-3">
        <div class="card h-100 border-secondary border-opacity-25 shadow-sm">
            <div class="card-body d-flex flex-column justify-content-center py-3 text-center">
                <div class="text-muted small text-uppercase fw-bold mb-1">Total Profit</div>
                <h4 class="mb-0 fw-bold {% if tile_total_profit_raw >= 0 %}text-success{% else %}text-danger{% endif %}">
                    {% if tile_total_profit_raw > 0 %}+{% endif %}{{ tile_total_profit_str }}
                    <small class="fs-6 opacity-50 d-none d-lg-inline text-muted">PLN</small>
                </h4>
            </div>
        </div>
    </div>

    <div class="col-6 col-md-3 col-xl-2">
        <div class="card h-100 border-secondary border-opacity-25 shadow-sm">
            <div class="card-body d-flex flex-column justify-content-center py-3 text-center">
                <div class="text-muted small text-uppercase fw-bold mb-1">Return</div>
                <h4 class="mb-0 fw-bold {% if tile_return_pct_raw >= 0 %}text-success{% else %}text-danger{% endif %}">
                    {% if tile_return_pct_raw > 0 %}+{% endif %}{{ tile_return_pct_str }}%
                </h4>
            </div>
        </div>
    </div>

    <div class="col-6 col-md-3 col-xl-2">
        <div class="card h-100 border-secondary border-opacity-25 shadow-sm position-relative"
             style="cursor: pointer;" onclick="togglePerf()">
            <div class="card-body d-flex flex-column justify-content-center py-3 text-center">
                <div class="d-flex justify-content-center gap-2 mb-1">
                    <span id="lbl-twr" class="small fw-bold text-white text-uppercase" style="border-bottom: 2px solid #00ff7f;">TWR</span>
                    <span class="text-muted small">|</span>
                    <span id="lbl-mwr" class="small fw-bold text-muted text-uppercase">MWR</span>
                </div>
                <h4 id="val-twr" class="mb-0 fw-bold {% if tile_twr|slice:':1' != '-' %}text-success{% else %}text-danger{% endif %}">
                    {{ tile_twr }}%
                </h4>
                <h4 id="val-mwr" class="mb-0 fw-bold {% if tile_mwr|slice:':1' != '-' %}text-success{% else %}text-danger{% endif %}" style="display: none;">
                    {{ tile_mwr }}%
                </h4>
            </div>
        </div>
    </div>

    <div class="col-6 col-md-12 col-xl-2">
        <div class="card h-100 border-secondary border-opacity-25 shadow-sm bg-dark">
            <div class="card-body d-flex flex-column justify-content-center py-3 text-center">
                <div class="text-muted small text-uppercase fw-bold mb-1">Unrealized</div>
                <h5 class="mb-0 fw-bold {% if tile_current_profit_raw >= 0 %}text-success{% else %}text-danger{% endif %}">
                    {{ tile_current_profit_str }} <span class="small opacity-50 d-none d-lg-inline text-muted">PLN</span>
                </h5>
            </div>
        </div>
    </div>
</div>

{# --- ROW 2: DAILY STATS (1D Change, Gain, Gainers, Losers) --- #}
<div class="row g-3 mb-5">
    <div class="col-6 col-lg-3">
        <div class="card h-100 border-secondary border-opacity-10 bg-transparent text-center">
            <div class="card-body py-2">
                <div class="text-muted small text-uppercase mb-1">1D Change</div>
                <div class="fw-bold fs-5 {% if tile_day_pct_raw >= 0 %}text-success{% else %}text-danger{% endif %}">
                    {% if tile_day_pct_raw > 0 %}<i class="fas fa-caret-up text-accent me-1"></i>{% else %}<i class="fas fa-caret-down text-danger me-1"></i>{% endif %}
                    {{ tile_day_pct_str }}%
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-lg-3">
        <div class="card h-100 border-secondary border-opacity-10 bg-transparent text-center">
            <div class="card-body py-2">
                <div class="text-muted small text-uppercase mb-1">1D Gain</div>
                <div class="fw-bold fs-5 {% if tile_day_pln_raw >= 0 %}text-success{% else %}text-danger{% endif %}">
                    {{ tile_day_pln_str }} <span class="small text-muted">PLN</span>
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-lg-3">
        <div class="card h-100 border-secondary border-opacity-10 bg-transparent text-center">
            <div class="card-body py-2">
                <div class="text-muted small text-uppercase mb-1"><i class="fas fa-arrow-up text-accent me-1"></i>Gainers</div>
                <div class="fw-bold fs-5 text-white">{{ tile_gainers }}</div>
            </div>
        </div>
    </div>
    <div class="col-6 col-lg-3">
        <div class="card h-100 border-secondary border-opacity-10 bg-transparent text-center">
            <div class="card-body py-2">
                <div class="text-muted small text-uppercase mb-1"><i class="fas fa-arrow-down text-danger me-1"></i>Losers</div>
                <div class="fw-bold fs-5 text-white">{{ tile_losers }}</div>
            </div>
        </div>
    </div>
</div>

<script>
    function togglePerf() {
        const vMwr = document.getElementById('val-mwr');
        const vTwr = document.getElementById('val-twr');
        const lMwr = document.getElementById('lbl-mwr');
        const lTwr = document.getElementById('lbl-twr');

        if (vTwr.style.display !== 'none') {
            // Pokaż MWR
            vMwr.style.display = 'block'; vTwr.style.display = 'none';
            lTwr.style.borderBottom = 'none'; lTwr.classList.replace('text-white', 'text-muted');
            lMwr.style.borderBottom = '2px solid #00ff7f'; lMwr.classList.replace('text-muted', 'text-white');
        } else {
            // Pokaż TWR
            vMwr.style.display = 'none'; vTwr.style.display = 'block';
            lMwr.style.borderBottom = 'none'; lMwr.classList.replace('text-white', 'text-muted');
            lTwr.style.borderBottom = '2px solid #00ff7f'; lTwr.classList.replace('text-muted', 'text-white');
        }
    }
</script>